<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abhinav's Banking Application Demo</title>
    <style>
        /* CSS from style.css */
        body {
            font-family: "Segoe UI", sans-serif;
            background-color: #f3f6fb;
            margin: 0;
            padding: 0;
            color: #222;
        }

        header {
            background: #004aad;
            color: white;
            text-align: center;
            padding: 1rem;
        }

        main {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            margin: 2rem;
        }

        section {
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            width: 80%;
            max-width: 700px;
        }

        h2 {
            color: #004aad;
            border-bottom: 2px solid #004aad;
            padding-bottom: 4px;
        }

        button, select, input {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            margin-right: 5px;
            border: 1px solid #ccc;
        }

        button {
            background: #004aad;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background: #00307a;
        }

        #logOutput {
            background: #111;
            color: #0f0;
            height: 200px;
            overflow-y: auto;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            white-space: pre-wrap; /* Ensure line breaks are preserved */
        }

        #controls > * {
            margin-bottom: 10px;
        }

    </style>
</head>
<body>
    <header>
        <h1>üè¶ Abhinav's Banking Application Demo</h1>
        <p>Observer + Strategy + Command Patterns</p>
    </header>

    <main>
        <section id="controls">
            <h2>Perform Transaction</h2>
            <select id="operation">
                <option value="deposit">Deposit (to Savings)</option>
                <option value="withdraw">Withdraw (from Savings)</option>
                <option value="transfer">Transfer (Savings to Current)</option>
            </select>

            <input type="number" id="amount" placeholder="Amount" />
            <button id="executeBtn">Execute</button>
            <button id="undoBtn">Undo</button>
        </section>

        <section id="accounts">
            <h2>Accounts</h2>
            <div id="accountInfo"></div>
        </section>

        <section id="log">
            <h2>Transaction Log</h2>
            <pre id="logOutput"></pre>
        </section>
    </main>

    <footer>
        <p>Designed with ‚ù§Ô∏è using JavaScript Design Patterns by Abhinav</p>
    </footer>

    <script>
        // ==========================
        // Observer Pattern
        // ==========================
        class Customer {
            constructor(name) {
                this.name = name;
            }
            update(account, message) {
                log(`[Notification] ${this.name}: ${message} | Balance: ‚Çπ${account.balance.toFixed(2)}`);
            }
        }

        // ==========================
        // Strategy Pattern
        // ==========================
        class InterestStrategy {
            calculate(account, years) { return 0; }
        }

        class SavingsInterest extends InterestStrategy {
            calculate(account, years) { return account.balance * 0.04 * years; }
        }

        class FDInterest extends InterestStrategy {
            calculate(account, years) { return account.balance * 0.07 * years; }
        }

        class CurrentInterest extends InterestStrategy {
            calculate(account, years) { return account.balance * 0.005 * years; }
        }

        // ==========================
        // Account (Subject in Observer)
        // ==========================
        class Account {
            constructor(id, type, balance, strategy) {
                this.id = id;
                this.type = type;
                this.balance = balance;
                this.observers = [];
                this.strategy = strategy;
            }

            addObserver(customer) { this.observers.push(customer); }
            notify(msg) { this.observers.forEach(o => o.update(this, msg)); }

            deposit(amount) {
                this.balance += amount;
                this.notify(`Deposited ‚Çπ${amount}`);
            }

            withdraw(amount) {
                if (this.balance < amount) {
                    log(`‚ùå Insufficient funds in ${this.id}`);
                    return false; // Indicate failure
                }
                this.balance -= amount;
                this.notify(`Withdrew ‚Çπ${amount}`);
                return true; // Indicate success
            }

            calculateInterest(years) {
                return this.strategy.calculate(this, years);
            }
        }

        // ==========================
        // Command Pattern
        // ==========================
        class Command {
            execute() {}
            undo() {}
        }

        class DepositCommand extends Command {
            constructor(account, amount) {
                super();
                this.account = account;
                this.amount = amount;
            }
            execute() { this.account.deposit(this.amount); }
            undo() { this.account.withdraw(this.amount); }
        }

        class WithdrawCommand extends Command {
            constructor(account, amount) {
                super();
                this.account = account;
                this.amount = amount;
            }
            execute() { this.account.withdraw(this.amount); }
            undo() { this.account.deposit(this.amount); }
        }

        class TransferCommand extends Command {
            constructor(from, to, amount) {
                super();
                this.from = from;
                this.to = to;
                this.amount = amount;
            }
            execute() {
                // Check if withdrawal is possible before attempting deposit
                if (this.from.withdraw(this.amount)) {
                    this.to.deposit(this.amount);
                    return true;
                }
                return false; // Transfer failed due to insufficient funds
            }
            undo() {
                // Undo assumes the transaction was successful and reverses the operations
                this.to.withdraw(this.amount);
                this.from.deposit(this.amount);
            }
        }

        class TransactionManager {
            constructor() { this.history = []; }
            execute(cmd) {
                // Only push successful commands to history for undo
                let success = cmd.execute();
                if (success !== false) { // Assuming commands return true/undefined on success
                    this.history.push(cmd);
                }
            }
            undo() {
                const last = this.history.pop();
                if (last) {
                    last.undo();
                    log(`‚Ü©Ô∏è Undid last operation`);
                } else {
                    log(`‚ö†Ô∏è No operations to undo`);
                }
            }
        }

        // ==========================
        // UI and Simulation
        // ==========================
        const logOutput = document.getElementById("logOutput");
        function log(msg) {
            logOutput.textContent += msg + "\n";
            logOutput.scrollTop = logOutput.scrollHeight;
        }

        const accountInfo = document.getElementById("accountInfo");

        // Create customers
        const abhinav = new Customer("Abhinav"); // Name changed
        const bob = new Customer("Bob");

        // Create accounts
        const savings = new Account("A1001", "Savings", 1000, new SavingsInterest());
        const current = new Account("C2001", "Current", 500, new CurrentInterest());

        // Subscribe
        savings.addObserver(abhinav); // Subscriber changed
        current.addObserver(bob);

        // Transaction manager
        const tm = new TransactionManager();

        function updateAccounts() {
            accountInfo.innerHTML = `
                <p><strong>${savings.id}</strong> (${savings.type} - **Abhinav's**) ‚Üí ‚Çπ${savings.balance.toFixed(2)}</p>
                <p><strong>${current.id}</strong> (${current.type} - **Bob's**) ‚Üí ‚Çπ${current.balance.toFixed(2)}</p>
            `;
        }
        updateAccounts();

        // Event handlers
        document.getElementById("executeBtn").onclick = () => {
            const op = document.getElementById("operation").value;
            const amountInput = document.getElementById("amount");
            const amt = parseFloat(amountInput.value);

            if (!amt || amt <= 0) return log("‚ö†Ô∏è Enter a valid amount.");

            let cmd;
            if (op === "deposit") cmd = new DepositCommand(savings, amt);
            else if (op === "withdraw") cmd = new WithdrawCommand(savings, amt);
            else if (op === "transfer") cmd = new TransferCommand(savings, current, amt);
            else return log("‚ö†Ô∏è Invalid operation selected.");

            tm.execute(cmd);
            updateAccounts();
            amountInput.value = ''; // Clear input after execution
        };

        document.getElementById("undoBtn").onclick = () => {
            tm.undo();
            updateAccounts();
        };

        // Initial log
        log(`Welcome, Abhinav! Initial balances set.`);
        log("üí° Interest (1 year):");
        log(`Savings (4%): ‚Çπ${savings.calculateInterest(1).toFixed(2)}`);
        log(`Current (0.5%): ‚Çπ${current.calculateInterest(1).toFixed(2)}`);

    </script>
</body>
</html>